function selectText(){var a;if(document.selection){a=document.body.createTextRange();a.moveToElementText(this);a.select()}else{if(window.getSelection){a=document.createRange();a.selectNode(this);window.getSelection().addRange(a)}}}$(document).ready(function(){$("body").on("click",".CopyCommand",selectText)});(function(){var m=document.createElement("input");try{m.type="range";if(m.type=="range"){return}}catch(k){return}if(!document.mozSetImageElement||!("MozAppearance" in m.style)){return}var g;var j=navigator.platform=="MacIntel";var a={radius:j?9:6,width:j?22:12,height:j?16:20};var d="-moz-linear-gradient(top, transparent "+(j?"6px, #999 6px, #999 7px, #ccc 9px, #bbb 11px, #bbb 12px, transparent 12px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)";var n={"min-width":a.width+"px","min-height":a.height+"px","max-height":a.height+"px",padding:0,border:0,"border-radius":0,cursor:"default","text-indent":"-999999px"};var l=document.createEvent("HTMLEvents");l.initEvent("change",true,false);if(document.readyState=="loading"){document.addEventListener("DOMContentLoaded",h,true)}else{h()}function h(){Array.forEach(document.querySelectorAll("input[type=range]"),f);document.addEventListener("DOMNodeInserted",i,true)}function i(o){c(o.target);if(o.target.querySelectorAll){Array.forEach(o.target.querySelectorAll("input"),c)}}function c(e,o){if(e.localName!="input"||e.type=="range"){}else{if(e.getAttribute("type")=="range"){f(e)}else{if(!o){setTimeout(c,0,e,true)}}}}function f(F){var w,L,v,K,H,I,u;var G,J,y,D,E=F.value;if(!g){g=document.body.appendChild(document.createElement("hr"));b(g,{"-moz-appearance":j?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"});document.mozSetImageElement("__sliderthumb__",g)}var q=function(){return""+E};var p=function p(M){E=""+M;w=true;A();delete F.value;F.value=E;F.__defineGetter__("value",q);F.__defineSetter__("value",p)};F.__defineGetter__("value",q);F.__defineSetter__("value",p);F.__defineGetter__("type",function(){return"range"});["min","max","step"].forEach(function(M){if(F.hasAttribute(M)){L=true}F.__defineGetter__(M,function(){return this.hasAttribute(M)?this.getAttribute(M):""});F.__defineSetter__(M,function(N){N===null?this.removeAttribute(M):this.setAttribute(M,N)})});F.readOnly=true;b(F,n);z();F.addEventListener("DOMAttrModified",function(M){if(M.attrName=="value"&&!w){E=M.newValue;A()}else{if(~["min","max","step"].indexOf(M.attrName)){z();L=true}}},true);F.addEventListener("mousedown",x,true);F.addEventListener("keydown",r,true);F.addEventListener("focus",t,true);F.addEventListener("blur",B,true);function x(O){K=true;setTimeout(function(){K=false},0);if(O.button||!D){return}var N=parseFloat(getComputedStyle(this,0).width);var P=(N-a.width)/D;if(!P){return}var M=O.clientX-this.getBoundingClientRect().left-a.width/2-(E-G)*P;if(Math.abs(M)>a.radius){v=true;this.value-=-M/P}I=E;u=O.clientX;this.addEventListener("mousemove",C,true);this.addEventListener("mouseup",o,true)}function C(N){var M=parseFloat(getComputedStyle(this,0).width);var O=(M-a.width)/D;if(!O){return}I+=(N.clientX-u)/O;u=N.clientX;v=true;this.value=I}function o(){this.removeEventListener("mousemove",C,true);this.removeEventListener("mouseup",o,true)}function r(M){if(M.keyCode>36&&M.keyCode<41){t.call(this);v=true;this.value=E+(M.keyCode==38||M.keyCode==39?y:-y)}}function t(){if(!K){this.style.boxShadow=!j?"0 0 0 2px #fb0":"0 0 2px 1px -moz-mac-focusring, inset 0 0 1px -moz-mac-focusring"}}function B(){this.style.boxShadow=""}function s(M){return !isNaN(M)&&+M==parseFloat(M)}function z(){G=s(F.min)?+F.min:0;J=s(F.max)?+F.max:100;if(J<G){J=G>100?G:100}y=s(F.step)&&F.step>0?+F.step:1;D=J-G;A(true)}function e(){if(!w&&!L){E=F.getAttribute("value")}if(!s(E)){E=(G+J)/2}E=Math.round((E-G)/y)*y+G;if(E<G){E=G}else{if(E>J){E=G+~~(D/y)*y}}}function A(O){e();if(v&&E!=H){F.dispatchEvent(l)}v=false;if(!O&&E==H){return}H=E;var M=D?(E-G)/D*100:0;var N="-moz-element(#__sliderthumb__) "+M+"% no-repeat, ";b(F,{background:N+d})}}function b(e,o){for(var p in o){e.style.setProperty(p,o[p],"important")}}})();(function(){var w=this;var k=w._;var E={};var D=Array.prototype,g=Object.prototype,r=Function.prototype;var I=D.push,o=D.slice,y=D.concat,B=D.unshift,d=g.toString,j=g.hasOwnProperty;var M=D.forEach,q=D.map,F=D.reduce,c=D.reduceRight,b=D.filter,C=D.every,p=D.some,n=D.indexOf,l=D.lastIndexOf,u=Array.isArray,f=Object.keys,G=r.bind;var N=function(O){if(O instanceof N){return O}if(!(this instanceof N)){return new N(O)}this._wrapped=O};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=N}exports._=N}else{w._=N}N.VERSION="1.4.2";var J=N.each=N.forEach=function(T,S,R){if(T==null){return}if(M&&T.forEach===M){T.forEach(S,R)}else{if(T.length===+T.length){for(var Q=0,O=T.length;Q<O;Q++){if(S.call(R,T[Q],Q,T)===E){return}}}else{for(var P in T){if(N.has(T,P)){if(S.call(R,T[P],P,T)===E){return}}}}}};N.map=N.collect=function(R,Q,P){var O=[];if(R==null){return O}if(q&&R.map===q){return R.map(Q,P)}J(R,function(U,S,T){O[O.length]=Q.call(P,U,S,T)});return O};N.reduce=N.foldl=N.inject=function(S,R,O,Q){var P=arguments.length>2;if(S==null){S=[]}if(F&&S.reduce===F){if(Q){R=N.bind(R,Q)}return P?S.reduce(R,O):S.reduce(R)}J(S,function(V,T,U){if(!P){O=V;P=true}else{O=R.call(Q,O,V,T,U)}});if(!P){throw new TypeError("Reduce of empty array with no initial value")}return O};N.reduceRight=N.foldr=function(U,R,O,Q){var P=arguments.length>2;if(U==null){U=[]}if(c&&U.reduceRight===c){if(Q){R=N.bind(R,Q)}return arguments.length>2?U.reduceRight(R,O):U.reduceRight(R)}var T=U.length;if(T!==+T){var S=N.keys(U);T=S.length}J(U,function(X,V,W){V=S?S[--T]:--T;if(!P){O=U[V];P=true}else{O=R.call(Q,O,U[V],V,W)}});if(!P){throw new TypeError("Reduce of empty array with no initial value")}return O};N.find=N.detect=function(R,Q,P){var O;A(R,function(U,S,T){if(Q.call(P,U,S,T)){O=U;return true}});return O};N.filter=N.select=function(R,Q,P){var O=[];if(R==null){return O}if(b&&R.filter===b){return R.filter(Q,P)}J(R,function(U,S,T){if(Q.call(P,U,S,T)){O[O.length]=U}});return O};N.reject=function(R,Q,P){var O=[];if(R==null){return O}J(R,function(U,S,T){if(!Q.call(P,U,S,T)){O[O.length]=U}});return O};N.every=N.all=function(R,Q,P){Q||(Q=N.identity);var O=true;if(R==null){return O}if(C&&R.every===C){return R.every(Q,P)}J(R,function(U,S,T){if(!(O=O&&Q.call(P,U,S,T))){return E}});return !!O};var A=N.some=N.any=function(R,Q,P){Q||(Q=N.identity);var O=false;if(R==null){return O}if(p&&R.some===p){return R.some(Q,P)}J(R,function(U,S,T){if(O||(O=Q.call(P,U,S,T))){return E}});return !!O};N.contains=N.include=function(Q,P){var O=false;if(Q==null){return O}if(n&&Q.indexOf===n){return Q.indexOf(P)!=-1}O=A(Q,function(R){return R===P});return O};N.invoke=function(P,Q){var O=o.call(arguments,2);return N.map(P,function(R){return(N.isFunction(Q)?Q:R[Q]).apply(R,O)})};N.pluck=function(P,O){return N.map(P,function(Q){return Q[O]})};N.where=function(P,O){if(N.isEmpty(O)){return[]}return N.filter(P,function(R){for(var Q in O){if(O[Q]!==R[Q]){return false}}return true})};N.max=function(R,Q,P){if(!Q&&N.isArray(R)&&R[0]===+R[0]&&R.length<65535){return Math.max.apply(Math,R)}if(!Q&&N.isEmpty(R)){return -Infinity}var O={computed:-Infinity};J(R,function(V,S,U){var T=Q?Q.call(P,V,S,U):V;T>=O.computed&&(O={value:V,computed:T})});return O.value};N.min=function(R,Q,P){if(!Q&&N.isArray(R)&&R[0]===+R[0]&&R.length<65535){return Math.min.apply(Math,R)}if(!Q&&N.isEmpty(R)){return Infinity}var O={computed:Infinity};J(R,function(V,S,U){var T=Q?Q.call(P,V,S,U):V;T<O.computed&&(O={value:V,computed:T})});return O.value};N.shuffle=function(R){var Q;var P=0;var O=[];J(R,function(S){Q=N.random(P++);O[P-1]=O[Q];O[Q]=S});return O};var a=function(O){return N.isFunction(O)?O:function(P){return P[O]}};N.sortBy=function(R,Q,O){var P=a(Q);return N.pluck(N.map(R,function(U,S,T){return{value:U,index:S,criteria:P.call(O,U,S,T)}}).sort(function(V,U){var T=V.criteria;var S=U.criteria;if(T!==S){if(T>S||T===void 0){return 1}if(T<S||S===void 0){return -1}}return V.index<U.index?-1:1}),"value")};var t=function(T,S,P,R){var O={};var Q=a(S);J(T,function(W,U){var V=Q.call(P,W,U,T);R(O,V,W)});return O};N.groupBy=function(Q,P,O){return t(Q,P,O,function(R,S,T){(N.has(R,S)?R[S]:(R[S]=[])).push(T)})};N.countBy=function(Q,P,O){return t(Q,P,O,function(R,S,T){if(!N.has(R,S)){R[S]=0}R[S]++})};N.sortedIndex=function(V,U,R,Q){R=R==null?N.identity:a(R);var T=R.call(Q,U);var O=0,S=V.length;while(O<S){var P=(O+S)>>>1;R.call(Q,V[P])<T?O=P+1:S=P}return O};N.toArray=function(O){if(!O){return[]}if(O.length===+O.length){return o.call(O)}return N.values(O)};N.size=function(O){return(O.length===+O.length)?O.length:N.keys(O).length};N.first=N.head=N.take=function(Q,P,O){return(P!=null)&&!O?o.call(Q,0,P):Q[0]};N.initial=function(Q,P,O){return o.call(Q,0,Q.length-((P==null)||O?1:P))};N.last=function(Q,P,O){if((P!=null)&&!O){return o.call(Q,Math.max(Q.length-P,0))}else{return Q[Q.length-1]}};N.rest=N.tail=N.drop=function(Q,P,O){return o.call(Q,(P==null)||O?1:P)};N.compact=function(O){return N.filter(O,function(P){return !!P})};var x=function(P,Q,O){J(P,function(R){if(N.isArray(R)){Q?I.apply(O,R):x(R,Q,O)}else{O.push(R)}});return O};N.flatten=function(P,O){return x(P,O,[])};N.without=function(O){return N.difference(O,o.call(arguments,1))};N.uniq=N.unique=function(U,T,S,R){var P=S?N.map(U,S,R):U;var Q=[];var O=[];J(P,function(W,V){if(T?(!V||O[O.length-1]!==W):!N.contains(O,W)){O.push(W);Q.push(U[V])}});return Q};N.union=function(){return N.uniq(y.apply(D,arguments))};N.intersection=function(P){var O=o.call(arguments,1);return N.filter(N.uniq(P),function(Q){return N.every(O,function(R){return N.indexOf(R,Q)>=0})})};N.difference=function(P){var O=y.apply(D,o.call(arguments,1));return N.filter(P,function(Q){return !N.contains(O,Q)})};N.zip=function(){var O=o.call(arguments);var R=N.max(N.pluck(O,"length"));var Q=new Array(R);for(var P=0;P<R;P++){Q[P]=N.pluck(O,""+P)}return Q};N.object=function(S,Q){var O={};for(var R=0,P=S.length;R<P;R++){if(Q){O[S[R]]=Q[R]}else{O[S[R][0]]=S[R][1]}}return O};N.indexOf=function(S,Q,R){if(S==null){return -1}var P=0,O=S.length;if(R){if(typeof R=="number"){P=(R<0?Math.max(0,O+R):R)}else{P=N.sortedIndex(S,Q);return S[P]===Q?P:-1}}if(n&&S.indexOf===n){return S.indexOf(Q,R)}for(;P<O;P++){if(S[P]===Q){return P}}return -1};N.lastIndexOf=function(S,Q,R){if(S==null){return -1}var O=R!=null;if(l&&S.lastIndexOf===l){return O?S.lastIndexOf(Q,R):S.lastIndexOf(Q)}var P=(O?R:S.length);while(P--){if(S[P]===Q){return P}}return -1};N.range=function(T,R,S){if(arguments.length<=1){R=T||0;T=0}S=arguments[2]||1;var P=Math.max(Math.ceil((R-T)/S),0);var O=0;var Q=new Array(P);while(O<P){Q[O++]=T;T+=S}return Q};var H=function(){};N.bind=function e(R,P){var Q,O;if(R.bind===G&&G){return G.apply(R,o.call(arguments,1))}if(!N.isFunction(R)){throw new TypeError}O=o.call(arguments,2);return Q=function(){if(!(this instanceof Q)){return R.apply(P,O.concat(o.call(arguments)))}H.prototype=R.prototype;var T=new H;var S=R.apply(T,O.concat(o.call(arguments)));if(Object(S)===S){return S}return T}};N.bindAll=function(P){var O=o.call(arguments,1);if(O.length==0){O=N.functions(P)}J(O,function(Q){P[Q]=N.bind(P[Q],P)});return P};N.memoize=function(Q,P){var O={};P||(P=N.identity);return function(){var R=P.apply(this,arguments);return N.has(O,R)?O[R]:(O[R]=Q.apply(this,arguments))}};N.delay=function(P,Q){var O=o.call(arguments,2);return setTimeout(function(){return P.apply(null,O)},Q)};N.defer=function(O){return N.delay.apply(N,[O,1].concat(o.call(arguments,1)))};N.throttle=function(Q,R){var P,T,U,V,S,W;var O=N.debounce(function(){S=V=false},R);return function(){P=this;T=arguments;var X=function(){U=null;if(S){W=Q.apply(P,T)}O()};if(!U){U=setTimeout(X,R)}if(V){S=true}else{V=true;W=Q.apply(P,T)}O();return W}};N.debounce=function(Q,S,P){var R,O;return function(){var W=this,V=arguments;var U=function(){R=null;if(!P){O=Q.apply(W,V)}};var T=P&&!R;clearTimeout(R);R=setTimeout(U,S);if(T){O=Q.apply(W,V)}return O}};N.once=function(Q){var O=false,P;return function(){if(O){return P}O=true;P=Q.apply(this,arguments);Q=null;return P}};N.wrap=function(O,P){return function(){var Q=[O];I.apply(Q,arguments);return P.apply(this,Q)}};N.compose=function(){var O=arguments;return function(){var P=arguments;for(var Q=O.length-1;Q>=0;Q--){P=[O[Q].apply(this,P)]}return P[0]}};N.after=function(P,O){if(P<=0){return O()}return function(){if(--P<1){return O.apply(this,arguments)}}};N.keys=f||function(Q){if(Q!==Object(Q)){throw new TypeError("Invalid object")}var P=[];for(var O in Q){if(N.has(Q,O)){P[P.length]=O}}return P};N.values=function(Q){var O=[];for(var P in Q){if(N.has(Q,P)){O.push(Q[P])}}return O};N.pairs=function(Q){var P=[];for(var O in Q){if(N.has(Q,O)){P.push([O,Q[O]])}}return P};N.invert=function(Q){var O={};for(var P in Q){if(N.has(Q,P)){O[Q[P]]=P}}return O};N.functions=N.methods=function(Q){var P=[];for(var O in Q){if(N.isFunction(Q[O])){P.push(O)}}return P.sort()};N.extend=function(O){J(o.call(arguments,1),function(P){for(var Q in P){O[Q]=P[Q]}});return O};N.pick=function(P){var Q={};var O=y.apply(D,o.call(arguments,1));J(O,function(R){if(R in P){Q[R]=P[R]}});return Q};N.omit=function(Q){var R={};var P=y.apply(D,o.call(arguments,1));for(var O in Q){if(!N.contains(P,O)){R[O]=Q[O]}}return R};N.defaults=function(O){J(o.call(arguments,1),function(P){for(var Q in P){if(O[Q]==null){O[Q]=P[Q]}}});return O};N.clone=function(O){if(!N.isObject(O)){return O}return N.isArray(O)?O.slice():N.extend({},O)};N.tap=function(P,O){O(P);return P};var K=function(V,U,P,Q){if(V===U){return V!==0||1/V==1/U}if(V==null||U==null){return V===U}if(V instanceof N){V=V._wrapped}if(U instanceof N){U=U._wrapped}var S=d.call(V);if(S!=d.call(U)){return false}switch(S){case"[object String]":return V==String(U);case"[object Number]":return V!=+V?U!=+U:(V==0?1/V==1/U:V==+U);case"[object Date]":case"[object Boolean]":return +V==+U;case"[object RegExp]":return V.source==U.source&&V.global==U.global&&V.multiline==U.multiline&&V.ignoreCase==U.ignoreCase}if(typeof V!="object"||typeof U!="object"){return false}var O=P.length;while(O--){if(P[O]==V){return Q[O]==U}}P.push(V);Q.push(U);var X=0,Y=true;if(S=="[object Array]"){X=V.length;Y=X==U.length;if(Y){while(X--){if(!(Y=K(V[X],U[X],P,Q))){break}}}}else{var T=V.constructor,R=U.constructor;if(T!==R&&!(N.isFunction(T)&&(T instanceof T)&&N.isFunction(R)&&(R instanceof R))){return false}for(var W in V){if(N.has(V,W)){X++;if(!(Y=N.has(U,W)&&K(V[W],U[W],P,Q))){break}}}if(Y){for(W in U){if(N.has(U,W)&&!(X--)){break}}Y=!X}}P.pop();Q.pop();return Y};N.isEqual=function(P,O){return K(P,O,[],[])};N.isEmpty=function(P){if(P==null){return true}if(N.isArray(P)||N.isString(P)){return P.length===0}for(var O in P){if(N.has(P,O)){return false}}return true};N.isElement=function(O){return !!(O&&O.nodeType===1)};N.isArray=u||function(O){return d.call(O)=="[object Array]"};N.isObject=function(O){return O===Object(O)};J(["Arguments","Function","String","Number","Date","RegExp"],function(O){N["is"+O]=function(P){return d.call(P)=="[object "+O+"]"}});if(!N.isArguments(arguments)){N.isArguments=function(O){return !!(O&&N.has(O,"callee"))}}if(typeof(/./)!=="function"){N.isFunction=function(O){return typeof O==="function"}}N.isFinite=function(O){return N.isNumber(O)&&isFinite(O)};N.isNaN=function(O){return N.isNumber(O)&&O!=+O};N.isBoolean=function(O){return O===true||O===false||d.call(O)=="[object Boolean]"};N.isNull=function(O){return O===null};N.isUndefined=function(O){return O===void 0};N.has=function(P,O){return j.call(P,O)};N.noConflict=function(){w._=k;return this};N.identity=function(O){return O};N.times=function(R,Q,P){for(var O=0;O<R;O++){Q.call(P,O)}};N.random=function(P,O){if(O==null){O=P;P=0}return P+(0|Math.random()*(O-P+1))};var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};m.unescape=N.invert(m.escape);var L={escape:new RegExp("["+N.keys(m.escape).join("")+"]","g"),unescape:new RegExp("("+N.keys(m.unescape).join("|")+")","g")};N.each(["escape","unescape"],function(O){N[O]=function(P){if(P==null){return""}return(""+P).replace(L[O],function(Q){return m[O][Q]})}});N.result=function(O,Q){if(O==null){return null}var P=O[Q];return N.isFunction(P)?P.call(O):P};N.mixin=function(O){J(N.functions(O),function(P){var Q=N[P]=O[P];N.prototype[P]=function(){var R=[this._wrapped];I.apply(R,arguments);return s.call(this,Q.apply(N,R))}})};var z=0;N.uniqueId=function(O){var P=z++;return O?O+P:P};N.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var v=/(.)^/;var h={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var i=/\\|'|\r|\n|\t|\u2028|\u2029/g;N.template=function(W,R,Q){Q=N.defaults({},Q,N.templateSettings);var S=new RegExp([(Q.escape||v).source,(Q.interpolate||v).source,(Q.evaluate||v).source].join("|")+"|$","g");var T=0;var O="__p+='";W.replace(S,function(Y,Z,X,ab,aa){O+=W.slice(T,aa).replace(i,function(ac){return"\\"+h[ac]});O+=Z?"'+\n((__t=("+Z+"))==null?'':_.escape(__t))+\n'":X?"'+\n((__t=("+X+"))==null?'':__t)+\n'":ab?"';\n"+ab+"\n__p+='":"";T=aa+Y.length});O+="';\n";if(!Q.variable){O="with(obj||{}){\n"+O+"}\n"}O="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+O+"return __p;\n";try{var P=new Function(Q.variable||"obj","_",O)}catch(U){U.source=O;throw U}if(R){return P(R,N)}var V=function(X){return P.call(this,X,N)};V.source="function("+(Q.variable||"obj")+"){\n"+O+"}";return V};N.chain=function(O){return N(O).chain()};var s=function(O){return this._chain?N(O).chain():O};N.mixin(N);J(["pop","push","reverse","shift","sort","splice","unshift"],function(O){var P=D[O];N.prototype[O]=function(){var Q=this._wrapped;P.apply(Q,arguments);if((O=="shift"||O=="splice")&&Q.length===0){delete Q[0]}return s.call(this,Q)}});J(["concat","join","slice"],function(O){var P=D[O];N.prototype[O]=function(){return s.call(this,P.apply(this._wrapped,arguments))}});N.extend(N.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);(function(){var e,a,k,m,u,v,q,z,B,C,A,d,w,f,p,x,g,b,s,y,l,i,h,r,j,n={}.hasOwnProperty,c=[].indexOf||function(F){for(var E=0,D=this.length;E<D;E++){if(E in this&&this[E]===F){return E}}return -1},t=this,o=[].slice;r=Array.prototype.slice;e=function(E,D){if(D==null){D=document}if(typeof E==="object"||(typeof exports!=="undefined"&&exports!==null)){return E}return D.querySelector(E)};i=(function(){function D(){}D.uniqid=(function(){var E;E=0;return{get:function(){return E++}}})();D.extend=function(H){var K,F,J,I,G,E;F=H;I=r.call(arguments,1);for(G=0,E=I.length;G<E;G++){K=I[G];for(J in K){if(!n.call(K,J)){continue}F[J]=K[J]}}return F};D.clampRGB=function(E){if(E<0){return 0}if(E>255){return 255}return E};D.copyAttributes=function(L,M,E){var J,H,K,I,G,F;if(E==null){E={}}I=L.attributes;F=[];for(H=0,K=I.length;H<K;H++){J=I[H];if((E.except!=null)&&(G=J.nodeName,c.call(E.except,G)>=0)){continue}F.push(M.setAttribute(J.nodeName,J.nodeValue))}return F};return D})();if(typeof exports!=="undefined"&&exports!==null){y=exports;q=require("canvas");w=q.Image;C=require("fibers");h=require("fs")}else{y=window}y.Caman=u=(function(){D.version={release:"4.1.0",date:"2/12/2013"};D.DEBUG=false;D.NodeJS=typeof exports!=="undefined"&&exports!==null;D.autoload=!D.NodeJS;D.allowRevert=true;D.crossOrigin="anonymous";D.toString=function(){return"Version "+D.version.release+", Released "+D.version.date};D.remoteProxy="";D.proxyParam="camanProxyUrl";D.getAttrId=function(E){if(D.NodeJS){return true}if(typeof E==="string"){E=e(E)}if(!((E!=null)&&(E.getAttribute!=null))){return null}return E.getAttribute("data-caman-id")};function D(){var E,H,G,F=this;if(arguments.length===0){throw"Invalid arguments"}if(this instanceof D){this.finishInit=this.finishInit.bind(this);this.imageLoaded=this.imageLoaded.bind(this);E=arguments[0];if(!D.NodeJS){G=parseInt(D.getAttrId(E[0]),10);H=typeof E[1]==="function"?E[1]:typeof E[2]==="function"?E[2]:function(){};if(!isNaN(G)&&l.has(G)){return l.execute(G,H)}}this.id=i.uniqid.get();this.initializedPixelData=this.originalPixelData=null;this.cropCoordinates={x:0,y:0};this.cropped=false;this.resized=false;this.pixelStack=[];this.layerStack=[];this.canvasQueue=[];this.currentLayer=null;this.scaled=false;this.analyze=new a(this);this.renderer=new s(this);this.domIsLoaded(function(){F.parseArguments(E);return F.setup()});return this}else{return new D(arguments)}}D.prototype.domIsLoaded=function(E){var F,G=this;if(D.NodeJS){return setTimeout(function(){return E.call(G)},0)}else{if(document.readyState==="complete"){p.debug("DOM initialized");return setTimeout(function(){return E.call(G)},0)}else{F=function(){if(document.readyState==="complete"){p.debug("DOM initialized");return E.call(G)}};return document.addEventListener("readystatechange",F,false)}}};D.prototype.parseArguments=function(F){var G,I,H,E;if(F.length===0){throw"Invalid arguments given"}this.initObj=null;this.initType=null;this.imageUrl=null;this.callback=function(){};this.setInitObject(F[0]);if(F.length===1){return}switch(typeof F[1]){case"string":this.imageUrl=F[1];break;case"function":this.callback=F[1]}if(F.length===2){return}this.callback=F[2];if(F.length===4){H=F[4];E=[];for(G in H){if(!n.call(H,G)){continue}I=H[G];E.push(this.options[G]=I)}return E}};D.prototype.setInitObject=function(E){if(D.NodeJS){this.initObj=E;this.initType="node";return}if(typeof E==="object"){this.initObj=E}else{this.initObj=e(E)}if(this.initObj==null){throw"Could not find image or canvas for initialization."}return this.initType=this.initObj.nodeName.toLowerCase()};D.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}};D.prototype.initNode=function(){var E=this;p.debug("Initializing for NodeJS");this.image=new w();this.image.onload=function(){p.debug("Image loaded. Width = "+(E.imageWidth())+", Height = "+(E.imageHeight()));E.canvas=new q(E.imageWidth(),E.imageHeight());return E.finishInit()};this.image.onerror=function(F){throw F};return this.image.src=this.initObj};D.prototype.initImage=function(){this.image=this.initObj;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");i.copyAttributes(this.image,this.canvas,{except:["src"]});this.image.parentNode.replaceChild(this.canvas,this.image);this.imageAdjustments();return this.waitForImageLoaded()};D.prototype.initCanvas=function(){this.canvas=this.initObj;this.context=this.canvas.getContext("2d");if(this.imageUrl!=null){this.image=document.createElement("img");this.image.src=this.imageUrl;this.imageAdjustments();return this.waitForImageLoaded()}else{return this.finishInit()}};D.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()){p.debug(this.image.src,"->",this.hiDPIReplacement());this.swapped=true;this.image.src=this.hiDPIReplacement()}if(d.isRemote(this.image)){this.image.src=d.proxyUrl(this.image.src);return p.debug("Remote image detected, using URL = "+this.image.src)}};D.prototype.waitForImageLoaded=function(){if(this.isImageLoaded()){return this.imageLoaded()}else{return this.image.onload=this.imageLoaded}};D.prototype.isImageLoaded=function(){if(!this.image.complete){return false}if((this.image.naturalWidth!=null)&&this.image.naturalWidth===0){return false}return true};D.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth};D.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight};D.prototype.imageLoaded=function(){p.debug("Image loaded. Width = "+(this.imageWidth())+", Height = "+(this.imageHeight()));if(this.swapped){this.canvas.width=this.imageWidth()/this.hiDPIRatio();this.canvas.height=this.imageHeight()/this.hiDPIRatio()}else{this.canvas.width=this.imageWidth();this.canvas.height=this.imageHeight()}return this.finishInit()};D.prototype.finishInit=function(){var G,F,I,E,H;if(this.context==null){this.context=this.canvas.getContext("2d")}this.originalWidth=this.preScaledWidth=this.width=this.canvas.width;this.originalHeight=this.preScaledHeight=this.height=this.canvas.height;this.hiDPIAdjustments();if(!this.hasId()){this.assignId()}if(this.image!=null){this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight)}this.reloadCanvasData();if(D.allowRevert){this.initializedPixelData=new Uint8Array(this.pixelData.length);this.originalPixelData=new Uint8Array(this.pixelData.length);H=this.pixelData;for(G=I=0,E=H.length;I<E;G=++I){F=H[G];this.initializedPixelData[G]=F;this.originalPixelData[G]=F}}this.dimensions={width:this.canvas.width,height:this.canvas.height};l.put(this.id,this);this.callback.call(this,this);return this.callback=function(){}};D.prototype.reloadCanvasData=function(){this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);return this.pixelData=this.imageData.data};D.prototype.resetOriginalPixelData=function(){var G,I,F,H,E;if(!D.allowRevert){throw"Revert disabled"}this.originalPixelData=new Uint8Array(this.pixelData.length);H=this.pixelData;E=[];for(I=0,F=H.length;I<F;I++){G=H[I];E.push(this.originalPixelData.push(G))}return E};D.prototype.hasId=function(){return D.getAttrId(this.canvas)!=null};D.prototype.assignId=function(){if(D.NodeJS||this.canvas.getAttribute("data-caman-id")){return}return this.canvas.setAttribute("data-caman-id",this.id)};D.prototype.hiDPIDisabled=function(){return this.canvas.getAttribute("data-caman-hidpi-disabled")!==null};D.prototype.hiDPIAdjustments=function(){var E;if(D.NodeJS||this.hiDPIDisabled()){return}E=this.hiDPIRatio();if(E!==1){p.debug("HiDPI ratio = "+E);this.scaled=true;this.preScaledWidth=this.canvas.width;this.preScaledHeight=this.canvas.height;this.canvas.width=this.preScaledWidth*E;this.canvas.height=this.preScaledHeight*E;this.canvas.style.width=""+this.preScaledWidth+"px";this.canvas.style.height=""+this.preScaledHeight+"px";this.context.scale(E,E);this.width=this.originalWidth=this.canvas.width;return this.height=this.originalHeight=this.canvas.height}};D.prototype.hiDPIRatio=function(){var F,E;E=window.devicePixelRatio||1;F=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1;return E/F};D.prototype.hiDPICapable=function(){return(window.devicePixelRatio!=null)&&window.devicePixelRatio!==1};D.prototype.needsHiDPISwap=function(){if(this.hiDPIDisabled()||!this.hiDPICapable()){return false}return this.hiDPIReplacement()!==null};D.prototype.hiDPIReplacement=function(){if(this.image==null){return null}return this.image.getAttribute("data-caman-hidpi")};D.prototype.replaceCanvas=function(F){var E;E=this.canvas;this.canvas=F;this.context=this.canvas.getContext("2d");E.parentNode.replaceChild(this.canvas,E);this.width=this.canvas.width;this.height=this.canvas.height;this.reloadCanvasData();return this.dimensions={width:this.canvas.width,height:this.canvas.height}};D.prototype.render=function(F){var E=this;if(F==null){F=function(){}}B.trigger(this,"renderStart");return this.renderer.execute(function(){E.context.putImageData(E.imageData,0,0);return F.call(E)})};D.prototype.revert=function(){var G,F,I,E,H;if(!D.allowRevert){throw"Revert disabled"}H=this.originalVisiblePixels();for(G=I=0,E=H.length;I<E;G=++I){F=H[G];this.pixelData[G]=F}return this.context.putImageData(this.imageData,0,0)};D.prototype.reset=function(){var G,M,J,E,F,L,H,K,I;G=document.createElement("canvas");i.copyAttributes(this.canvas,G);G.width=this.originalWidth;G.height=this.originalHeight;M=G.getContext("2d");E=M.getImageData(0,0,G.width,G.height);L=E.data;I=this.initializedPixelData;for(J=H=0,K=I.length;H<K;J=++H){F=I[J];L[J]=F}M.putImageData(E,0,0);this.cropCoordinates={x:0,y:0};this.resized=false;return this.replaceCanvas(G)};D.prototype.originalVisiblePixels=function(){var L,T,S,F,E,U,W,M,N,Q,P,X,V,R,I,G,Y,O,K,J,H;if(!D.allowRevert){throw"Revert disabled"}Q=[];X=this.cropCoordinates.x;F=X+this.width;V=this.cropCoordinates.y;E=V+this.height;if(this.resized){L=document.createElement("canvas");L.width=this.originalWidth;L.height=this.originalHeight;S=L.getContext("2d");W=S.getImageData(0,0,L.width,L.height);N=W.data;O=this.originalPixelData;for(U=I=0,Y=O.length;I<Y;U=++I){M=O[U];N[U]=M}S.putImageData(W,0,0);P=document.createElement("canvas");P.width=this.width;P.height=this.height;S=P.getContext("2d");S.drawImage(L,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height);N=S.getImageData(0,0,this.width,this.height).data;R=this.width}else{N=this.originalPixelData;R=this.originalWidth}for(U=G=0,K=N.length;G<K;U=G+=4){T=g.locationToCoordinates(U,R);if(((X<=(J=T.x)&&J<F))&&((V<=(H=T.y)&&H<E))){Q.push(N[U],N[U+1],N[U+2],N[U+3])}}return Q};D.prototype.process=function(E,F){this.renderer.add({type:A.Type.Single,name:E,processFn:F});return this};D.prototype.processKernel=function(F,J,K,E){var G,I,H;if(!K){K=0;for(G=I=0,H=J.length;0<=H?I<H:I>H;G=0<=H?++I:--I){K+=J[G]}}this.renderer.add({type:A.Type.Kernel,name:F,adjust:J,divisor:K,bias:E||0});return this};D.prototype.processPlugin=function(F,E){this.renderer.add({type:A.Type.Plugin,plugin:F,args:E});return this};D.prototype.newLayer=function(F){var E;E=new f(this);this.canvasQueue.push(E);this.renderer.add({type:A.Type.LayerDequeue});F.call(E);this.renderer.add({type:A.Type.LayerFinished});return this};D.prototype.executeLayer=function(E){return this.pushContext(E)};D.prototype.pushContext=function(E){this.layerStack.push(this.currentLayer);this.pixelStack.push(this.pixelData);this.currentLayer=E;return this.pixelData=E.pixelData};D.prototype.popContext=function(){this.pixelData=this.pixelStack.pop();return this.currentLayer=this.layerStack.pop()};D.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()};return D})();a=(function(){function D(E){this.c=E}D.prototype.calculateLevels=function(){var E,J,K,I,G,F,H;J={r:{},g:{},b:{}};for(E=I=0;I<=255;E=++I){J.r[E]=0;J.g[E]=0;J.b[E]=0}for(E=G=0,H=this.c.pixelData.length;G<H;E=G+=4){J.r[this.c.pixelData[E]]++;J.g[this.c.pixelData[E+1]]++;J.b[this.c.pixelData[E+2]]++}K=this.c.pixelData.length/4;for(E=F=0;F<=255;E=++F){J.r[E]/=K;J.g[E]/=K;J.b[E]/=K}return J};return D})();u.DOMUpdated=function(){var F,I,H,G,E,D;I=document.querySelectorAll("img[data-caman]");if(!(I.length>0)){return}D=[];for(G=0,E=I.length;G<E;G++){F=I[G];D.push(H=new v(F,function(){this.parse();return this.execute()}))}return D};if(u.autoload){(function(){if(document.readyState==="complete"){return u.DOMUpdated()}else{return document.addEventListener("DOMContentLoaded",u.DOMUpdated,false)}})()}v=(function(){var E;E="(\\w+)\\((.*?)\\)";function D(G,F){this.dataStr=G.getAttribute("data-caman");this.caman=u(G,F.bind(this))}D.prototype.parse=function(){var P,G,H,M,Q,I,F,O,K,R,L,J;this.ele=this.caman.canvas;F=new RegExp(E,"g");O=this.dataStr.match(F);if(!(O.length>0)){return}F=new RegExp(E);J=[];for(K=0,R=O.length;K<R;K++){M=O[K];L=M.match(F),I=L[0],G=L[1],P=L[2];Q=new Function("return function() {        this."+G+"("+P+");      };");try{H=Q();J.push(H.call(this.caman))}catch(N){J.push(p.debug(N))}}return J};D.prototype.execute=function(){var F;F=this.ele;return this.caman.render(function(){return F.parentNode.replaceChild(this.toImage(),F)})};return D})();u.Blender=k=(function(){function D(){}D.blenders={};D.register=function(E,F){return this.blenders[E]=F};D.execute=function(E,F,G){return this.blenders[E](F,G)};return D})();u.Calculate=m=(function(){function D(){}D.distance=function(F,H,E,G){return Math.sqrt(Math.pow(E-F,2)+Math.pow(G-H,2))};D.randomRange=function(G,E,F){var H;if(F==null){F=false}H=G+(Math.random()*(E-G));if(F){return H.toFixed(F)}else{return Math.round(H)}};D.luminance=function(E){return(0.299*E.r)+(0.587*E.g)+(0.114*E.b)};D.bezier=function(U,Q,N,S,ac,W){var ab,aa,ak,aj,V,T,Y,G,F,af,ad,E,I,Z,ai,ah,ag,ae,R,P,M,L,K,J,H,X,O;ai=U[0];R=U[1];ah=Q[0];P=Q[1];ag=N[0];M=N[1];ae=S[0];L=S[1];Y={};V=parseInt(3*(ah-ai),10);ak=3*(ag-ah)-V;ab=ae-ai-V-ak;T=3*(P-R);aj=3*(M-P)-T;aa=L-R-T-aj;for(af=K=0;K<1000;af=++K){Z=af/1000;G=Math.round((ab*Math.pow(Z,3))+(ak*Math.pow(Z,2))+(V*Z)+ai);F=Math.round((aa*Math.pow(Z,3))+(aj*Math.pow(Z,2))+(T*Z)+R);if(ac&&F<ac){F=ac}else{if(W&&F>W){F=W}}Y[G]=F}if(Y.length<S[0]+1){for(af=J=0,X=S[0];0<=X?J<=X:J>=X;af=0<=X?++J:--J){if(Y[af]==null){E=[af-1,Y[af-1]];for(ad=H=af,O=S[0];af<=O?H<=O:H>=O;ad=af<=O?++H:--H){if(Y[ad]!=null){I=[ad,Y[ad]];break}}Y[af]=E[1]+((I[1]-E[1])/(I[0]-E[0]))*(af-E[0])}}}if(Y[S[0]]==null){Y[S[0]]=Y[S[0]-1]}return Y};return D})();z=(function(){function D(){}D.hexToRGB=function(H){var E,G,F;if(H.charAt(0)==="#"){H=H.substr(1)}F=parseInt(H.substr(0,2),16);G=parseInt(H.substr(2,2),16);E=parseInt(H.substr(4,2),16);return{r:F,g:G,b:E}};D.rgbToHSL=function(E,I,K){var J,H,F,L,G,M;if(typeof E==="object"){I=E.g;K=E.b;E=E.r}E/=255;I/=255;K/=255;L=Math.max(E,I,K);G=Math.min(E,I,K);F=(L+G)/2;if(L===G){H=M=0}else{J=L-G;M=F>0.5?J/(2-L-G):J/(L+G);H=(function(){switch(L){case E:return(I-K)/J+(I<K?6:0);case I:return(K-E)/J+2;case K:return(E-I)/J+4}})();H/=6}return{h:H,s:M,l:F}};D.hslToRGB=function(H,G,F){var E,J,L,K,I;if(typeof H==="object"){G=H.s;F=H.l;H=H.h}if(G===0){I=J=E=F}else{K=F<0.5?F*(1+G):F+G-F*G;L=2*F-K;I=this.hueToRGB(L,K,H+1/3);J=this.hueToRGB(L,K,H);E=this.hueToRGB(L,K,H-1/3)}return{r:I*255,g:J*255,b:E*255}};D.hueToRGB=function(G,F,E){if(E<0){E+=1}if(E>1){E-=1}if(E<1/6){return G+(F-G)*6*E}if(E<1/2){return F}if(E<2/3){return G+(F-G)*(2/3-E)*6}return G};D.rgbToHSV=function(E,H,J){var I,G,K,F,M,L;E/=255;H/=255;J/=255;K=Math.max(E,H,J);F=Math.min(E,H,J);L=K;I=K-F;M=K===0?0:I/K;if(K===F){G=0}else{G=(function(){switch(K){case E:return(H-J)/I+(H<J?6:0);case H:return(J-E)/I+2;case J:return(E-H)/I+4}})();G/=6}return{h:G,s:M,v:L}};D.hsvToRGB=function(I,O,M){var L,K,J,H,G,F,E,N;H=Math.floor(I*6);K=I*6-H;G=M*(1-O);F=M*(1-K*O);N=M*(1-(1-K)*O);switch(H%6){case 0:E=M;J=N;L=G;break;case 1:E=F;J=M;L=G;break;case 2:E=G;J=M;L=N;break;case 3:E=G;J=F;L=M;break;case 4:E=N;J=G;L=M;break;case 5:E=M;J=G;L=F}return{r:E*255,g:J*255,b:L*255}};D.rgbToXYZ=function(H,G,F){var E,J,I;H/=255;G/=255;F/=255;if(H>0.04045){H=Math.pow((H+0.055)/1.055,2.4)}else{H/=12.92}if(G>0.04045){G=Math.pow((G+0.055)/1.055,2.4)}else{G/=12.92}if(F>0.04045){F=Math.pow((F+0.055)/1.055,2.4)}else{F/=12.92}E=H*0.4124+G*0.3576+F*0.1805;J=H*0.2126+G*0.7152+F*0.0722;I=H*0.0193+G*0.1192+F*0.9505;return{x:E*100,y:J*100,z:I*100}};D.xyzToRGB=function(F,J,I){var E,H,G;F/=100;J/=100;I/=100;G=(3.2406*F)+(-1.5372*J)+(-0.4986*I);H=(-0.9689*F)+(1.8758*J)+(0.0415*I);E=(0.0557*F)+(-0.204*J)+(1.057*I);if(G>0.0031308){G=(1.055*Math.pow(G,0.4166666667))-0.055}else{G*=12.92}if(H>0.0031308){H=(1.055*Math.pow(H,0.4166666667))-0.055}else{H*=12.92}if(E>0.0031308){E=(1.055*Math.pow(E,0.4166666667))-0.055}else{E*=12.92}return{r:G*255,g:H*255,b:E*255}};D.xyzToLab=function(M,J,I){var L,K,H,G,F,E;if(typeof M==="object"){J=M.y;I=M.z;M=M.x}G=95.047;F=100;E=108.883;M/=G;J/=F;I/=E;if(M>0.008856451679){M=Math.pow(M,0.3333333333)}else{M=(7.787037037*M)+0.1379310345}if(J>0.008856451679){J=Math.pow(J,0.3333333333)}else{J=(7.787037037*J)+0.1379310345}if(I>0.008856451679){I=Math.pow(I,0.3333333333)}else{I=(7.787037037*I)+0.1379310345}H=116*J-16;L=500*(M-J);K=200*(J-I);return{l:H,a:L,b:K}};D.labToXYZ=function(H,G,F){var E,J,I;if(typeof H==="object"){G=H.a;F=H.b;H=H.l}J=(H+16)/116;E=J+(G/500);I=J-(F/200);if(E>0.2068965517){E=E*E*E}else{E=0.1284185493*(E-0.1379310345)}if(J>0.2068965517){J=J*J*J}else{J=0.1284185493*(J-0.1379310345)}if(I>0.2068965517){I=I*I*I}else{I=0.1284185493*(I-0.1379310345)}return{x:E*95.047,y:J*100,z:I*108.883}};D.rgbToLab=function(H,G,E){var F;if(typeof H==="object"){G=H.g;E=H.b;H=H.r}F=this.rgbToXYZ(H,G,E);return this.xyzToLab(F)};D.labToRGB=function(G,F,E){};return D})();B=(function(){function D(){}D.events={};D.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"];D.trigger=function(L,G,K){var H,J,F,I,E;if(this.events[G]&&this.events[G].length){I=this.events[G];E=[];for(J=0,F=I.length;J<F;J++){H=I[J];if(H.target===null||L.id===H.target.id){E.push(H.fn.call(L,K))}else{E.push(void 0)}}return E}};D.listen=function(H,G,F){var I,E;if(typeof H==="string"){E=H;I=G;H=null;G=E;F=I}if(c.call(this.types,G)<0){return false}if(!this.events[G]){this.events[G]=[]}this.events[G].push({target:H,fn:F});return true};return D})();u.Event=B;u.Filter=A=(function(){function D(){}D.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6};D.register=function(E,F){return u.prototype[E]=F};return D})();u.IO=d=(function(){function D(){}D.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/;D.isRemote=function(E){if(E==null){return false}if(this.corsEnabled(E)){return false}return this.isURLRemote(E.src)};D.corsEnabled=function(E){var F;return(E.crossOrigin!=null)&&((F=E.crossOrigin.toLowerCase())==="anonymous"||F==="use-credentials")};D.isURLRemote=function(E){var F;F=E.match(this.domainRegex);if(F){return F[1]!==document.domain}else{return false}};D.remoteCheck=function(E){if(this.isURLRemote(E)){if(!u.remoteProxy.length){p.info("Attempting to load a remote image without a configured proxy. URL: "+E)}else{if(u.isURLRemote(u.remoteProxy)){p.info("Cannot use a remote proxy for loading images.");return}return""+u.remoteProxy+"?camanProxyUrl="+(encodeURIComponent(E))}}};D.proxyUrl=function(E){return""+u.remoteProxy+"?"+u.proxyParam+"="+(encodeURIComponent(E))};D.useProxy=function(F){var E;E={ruby:"rb",python:"py",perl:"pl",javascript:"js"};F=F.toLowerCase();if(E[F]!=null){F=E[F]}return"proxies/caman_proxy."+F};return D})();u.prototype.save=function(){if(typeof exports!=="undefined"&&exports!==null){return this.nodeSave.apply(this,arguments)}else{return this.browserSave.apply(this,arguments)}};u.prototype.browserSave=function(D){var E;if(D==null){D="png"}D=D.toLowerCase();E=this.toBase64(D).replace("image/"+D,"image/octet-stream");return document.location.href=E};u.prototype.nodeSave=function(F,D){var E;if(D==null){D=true}try{E=h.statSync(F);if(E.isFile()&&!D){return false}}catch(G){p.debug("Creating output file "+F)}return h.writeFile(F,this.canvas.toBuffer(),function(){return p.debug("Finished writing to "+F)})};u.prototype.toImage=function(E){var D;D=document.createElement("img");D.src=this.toBase64(E);D.width=this.dimensions.width;D.height=this.dimensions.height;if(window.devicePixelRatio){D.width/=window.devicePixelRatio;D.height/=window.devicePixelRatio}return D};u.prototype.toBase64=function(D){if(D==null){D="png"}D=D.toLowerCase();return this.canvas.toDataURL("image/"+D)};f=(function(){function D(E){this.c=E;this.filter=this.c;this.options={blendingMode:"normal",opacity:1};this.layerID=i.uniqid.get();this.canvas=typeof exports!=="undefined"&&exports!==null?new q():document.createElement("canvas");this.canvas.width=this.c.dimensions.width;this.canvas.height=this.c.dimensions.height;this.context=this.canvas.getContext("2d");this.context.createImageData(this.canvas.width,this.canvas.height);this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.pixelData=this.imageData.data}D.prototype.newLayer=function(E){return this.c.newLayer.call(this.c,E)};D.prototype.setBlendingMode=function(E){this.options.blendingMode=E;return this};D.prototype.opacity=function(E){this.options.opacity=E/100;return this};D.prototype.copyParent=function(){var F,E,H,G;E=this.c.pixelData;for(F=H=0,G=this.c.pixelData.length;H<G;F=H+=4){this.pixelData[F]=E[F];this.pixelData[F+1]=E[F+1];this.pixelData[F+2]=E[F+2];this.pixelData[F+3]=E[F+3]}return this};D.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)};D.prototype.overlayImage=function(E){if(typeof E==="object"){E=E.src}else{if(typeof E==="string"&&E[0]==="#"){E=e(E).src}}if(!E){return this}this.c.renderer.renderQueue.push({type:A.Type.LoadOverlay,src:E,layer:this});return this};D.prototype.applyToParent=function(){var J,L,K,M,E,G,H,I,F;K=this.c.pixelStack[this.c.pixelStack.length-1];L=this.c.pixelData;F=[];for(J=H=0,I=L.length;H<I;J=H+=4){G={r:K[J],g:K[J+1],b:K[J+2],a:K[J+3]};E={r:L[J],g:L[J+1],b:L[J+2],a:L[J+3]};M=k.execute(this.options.blendingMode,E,G);M.r=i.clampRGB(M.r);M.g=i.clampRGB(M.g);M.b=i.clampRGB(M.b);if(M.a==null){M.a=E.a}K[J]=G.r-((G.r-M.r)*(this.options.opacity*(M.a/255)));K[J+1]=G.g-((G.g-M.g)*(this.options.opacity*(M.a/255)));F.push(K[J+2]=G.b-((G.b-M.b)*(this.options.opacity*(M.a/255))))}return F};return D})();x=(function(){function D(){var F,H,E,G;G=["log","info","warn","error"];for(H=0,E=G.length;H<E;H++){F=G[H];this[F]=(function(I){return function(){if(!u.DEBUG){return}return console[I].apply(console,arguments)}})(F)}this.debug=this.log}return D})();p=new x();g=(function(){D.coordinatesToLocation=function(E,G,F){return(G*F+E)*4};D.locationToCoordinates=function(G,F){var E,H;H=Math.floor(G/(F*4));E=(G%(F*4))/4;return{x:E,y:H}};function D(E){this.c=E;this.loc=0}D.prototype.locationXY=function(){var E,F;F=this.c.dimensions.height-Math.floor(this.loc/(this.c.dimensions.width*4));E=(this.loc%(this.c.dimensions.width*4))/4;return{x:E,y:F}};D.prototype.getPixelRelative=function(G,E){var F;F=this.loc+(this.c.dimensions.width*4*(E*-1))+(4*G);if(F>this.c.pixelData.length||F<0){return{r:0,g:0,b:0,a:0}}return{r:this.c.pixelData[F],g:this.c.pixelData[F+1],b:this.c.pixelData[F+2],a:this.c.pixelData[F+3]}};D.prototype.putPixelRelative=function(H,E,F){var G;G=this.loc+(this.c.dimensions.width*4*(E*-1))+(4*H);if(newLoc>this.c.pixelData.length||newLoc<0){return}this.c.pixelData[newLoc]=F.r;this.c.pixelData[newLoc+1]=F.g;this.c.pixelData[newLoc+2]=F.b;this.c.pixelData[newLoc+3]=F.a;return true};D.prototype.getPixel=function(E,G){var F;F=this.coordinatesToLocation(E,G,this.width);return{r:this.c.pixelData[F],g:this.c.pixelData[F+1],b:this.c.pixelData[F+2],a:this.c.pixelData[F+3]}};D.prototype.putPixel=function(E,H,F){var G;G=this.coordinatesToLocation(E,H,this.width);this.c.pixelData[G]=F.r;this.c.pixelData[G+1]=F.g;this.c.pixelData[G+2]=F.b;return this.c.pixelData[G+3]=F.a};return D})();b=(function(){function D(){}D.plugins={};D.register=function(E,F){return this.plugins[E]=F};D.execute=function(G,F,E){return this.plugins[F].apply(G,E)};return D})();u.Plugin=b;u.Renderer=s=(function(){D.Blocks=u.NodeJS?require("os").cpus().length:4;function D(F){var E=this;this.c=F;this.processNext=function(){return D.prototype.processNext.apply(E,arguments)};this.renderQueue=[];this.modPixelData=null}D.prototype.add=function(E){if(E==null){return}return this.renderQueue.push(E)};D.prototype.processNext=function(){var E;if(this.renderQueue.length===0){B.trigger(this,"renderFinished");if(this.finishedFn!=null){this.finishedFn.call(this.c)}return this}this.currentJob=this.renderQueue.shift();switch(this.currentJob.type){case A.Type.LayerDequeue:E=this.c.canvasQueue.shift();this.c.executeLayer(E);return this.processNext();case A.Type.LayerFinished:this.c.applyCurrentLayer();this.c.popContext();return this.processNext();case A.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case A.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}};D.prototype.execute=function(E){this.finishedFn=E;this.modPixelData=new Uint8Array(this.c.pixelData.length);return this.processNext()};D.prototype.eachBlock=function(P){var O,Q,R,I,N,L,H,F,E,J,K,G,M=this;this.blocksDone=0;F=this.c.pixelData.length;Q=Math.floor((F/4)/D.Blocks);O=Q*4;H=O+((F/4)%D.Blocks)*4;G=[];for(L=J=0,K=D.Blocks;0<=K?J<K:J>K;L=0<=K?++J:--J){E=L*O;I=E+(L===D.Blocks-1?H:O);if(u.NodeJS){N=C(function(){return P.call(M,L,E,I)});R=N.run();G.push(this.blockFinished(R))}else{G.push(setTimeout((function(T,U,S){return function(){return P.call(M,T,U,S)}})(L,E,I),0))}}return G};D.prototype.executeFilter=function(){B.trigger(this.c,"processStart",this.currentJob);if(this.currentJob.type===A.Type.Single){return this.eachBlock(this.renderBlock)}else{return this.eachBlock(this.renderKernel)}};D.prototype.executePlugin=function(){p.debug("Executing plugin "+this.currentJob.plugin);b.execute(this.c,this.currentJob.plugin,this.currentJob.args);p.debug("Plugin "+this.currentJob.plugin+" finished!");return this.processNext()};D.prototype.renderBlock=function(I,L,E){var K,G,H,F,J;p.debug("Block #"+I+" - Filter: "+this.currentJob.name+", Start: "+L+", End: "+E);B.trigger(this.c,"blockStarted",{blockNum:I,totalBlocks:D.Blocks,startPixel:L,endPixel:E});K={r:0,g:0,b:0,a:0};H=new g(this.c);for(G=J=L;J<E;G=J+=4){H.loc=G;K.r=this.c.pixelData[G];K.g=this.c.pixelData[G+1];K.b=this.c.pixelData[G+2];K.a=this.c.pixelData[G+3];F=this.currentJob.processFn.call(H,K);if(F.a==null){F.a=K.a}this.c.pixelData[G]=i.clampRGB(F.r);this.c.pixelData[G+1]=i.clampRGB(F.g);this.c.pixelData[G+2]=i.clampRGB(F.b);this.c.pixelData[G+3]=i.clampRGB(F.a)}if(u.NodeJS){return C.yield(I)}else{return this.blockFinished(I)}};D.prototype.renderKernel=function(W,M,J){var S,K,N,R,I,P,V,U,T,O,Q,Y,L,H,X,G,F,E;Y=this.currentJob.name;N=this.currentJob.bias;P=this.currentJob.divisor;Q=this.c.pixelData.length;S=this.currentJob.adjust;K=Math.sqrt(S.length);O=[];p.debug("Rendering kernel - Filter: "+this.currentJob.name);M=Math.max(M,this.c.dimensions.width*4*((K-1)/2));J=Math.min(J,Q-(this.c.dimensions.width*4*((K-1)/2)));R=(K-1)/2;H=new g(this.c);for(V=G=M;G<J;V=G+=4){H.loc=V;I=0;for(U=F=-R;-R<=R?F<=R:F>=R;U=-R<=R?++F:--F){for(T=E=R;R<=-R?E<=-R:E>=-R;T=R<=-R?++E:--E){L=H.getPixelRelative(U,T);O[I*3]=L.r;O[I*3+1]=L.g;O[I*3+2]=L.b;I++}}X=this.processKernel(S,O,P,N);this.modPixelData[V]=i.clampRGB(X.r);this.modPixelData[V+1]=i.clampRGB(X.g);this.modPixelData[V+2]=i.clampRGB(X.b);this.modPixelData[V+3]=this.c.pixelData[V+3]}if(u.NodeJS){return C.yield(W)}else{return this.blockFinished(W)}};D.prototype.blockFinished=function(F){var E,H,G;if(F>=0){p.debug("Block #"+F+" finished! Filter: "+this.currentJob.name)}this.blocksDone++;B.trigger(this.c,"blockFinished",{blockNum:F,blocksFinished:this.blocksDone,totalBlocks:D.Blocks});if(this.blocksDone===D.Blocks){if(this.currentJob.type===A.Type.Kernel){for(E=H=0,G=this.c.pixelData.length;0<=G?H<G:H>G;E=0<=G?++H:--H){this.c.pixelData[E]=this.modPixelData[E]}}if(F>=0){p.debug("Filter "+this.currentJob.name+" finished!")}B.trigger(this.c,"processComplete",this.currentJob);return this.processNext()}};D.prototype.processKernel=function(I,L,K,E){var F,J,H,G;J={r:0,g:0,b:0};for(F=H=0,G=I.length;0<=G?H<G:H>G;F=0<=G?++H:--H){J.r+=I[F]*L[F*3];J.g+=I[F]*L[F*3+1];J.b+=I[F]*L[F*3+2]}J.r=(J.r/K)+E;J.g=(J.g/K)+E;J.b=(J.b/K)+E;return J};D.prototype.loadOverlay=function(F,G){var E,I,H=this;E=document.createElement("img");E.onload=function(){F.context.drawImage(E,0,0,H.c.dimensions.width,H.c.dimensions.height);F.imageData=F.context.getImageData(0,0,H.c.dimensions.width,H.c.dimensions.height);F.pixelData=F.imageData.data;H.c.pixelData=F.pixelData;return H.processNext()};I=d.remoteCheck(G);return E.src=I!=null?I:G};return D})();u.Store=l=(function(){function D(){}D.items={};D.has=function(E){return this.items[E]!=null};D.get=function(E){return this.items[E]};D.put=function(E,F){return this.items[E]=F};D.execute=function(E,G){var F=this;setTimeout(function(){return G.call(F.get(E),F.get(E))},0);return this.get(E)};D.flush=function(E){if(E==null){E=false}if(E){return delete this.items[E]}else{return this.items={}}};return D})();k.register("normal",function(D,E){return{r:D.r,g:D.g,b:D.b}});k.register("multiply",function(D,E){return{r:(D.r*E.r)/255,g:(D.g*E.g)/255,b:(D.b*E.b)/255}});k.register("screen",function(D,E){return{r:255-(((255-D.r)*(255-E.r))/255),g:255-(((255-D.g)*(255-E.g))/255),b:255-(((255-D.b)*(255-E.b))/255)}});k.register("overlay",function(E,F){var D;D={};D.r=F.r>128?255-2*(255-E.r)*(255-F.r)/255:(F.r*E.r*2)/255;D.g=F.g>128?255-2*(255-E.g)*(255-F.g)/255:(F.g*E.g*2)/255;D.b=F.b>128?255-2*(255-E.b)*(255-F.b)/255:(F.b*E.b*2)/255;return D});k.register("difference",function(D,E){return{r:D.r-E.r,g:D.g-E.g,b:D.b-E.b}});k.register("addition",function(D,E){return{r:E.r+D.r,g:E.g+D.g,b:E.b+D.b}});k.register("exclusion",function(D,E){return{r:128-2*(E.r-128)*(D.r-128)/255,g:128-2*(E.g-128)*(D.g-128)/255,b:128-2*(E.b-128)*(D.b-128)/255}});k.register("softLight",function(E,F){var D;D={};D.r=F.r>128?255-((255-F.r)*(255-(E.r-128)))/255:(F.r*(E.r+128))/255;D.g=F.g>128?255-((255-F.g)*(255-(E.g-128)))/255:(F.g*(E.g+128))/255;D.b=F.b>128?255-((255-F.b)*(255-(E.b-128)))/255:(F.b*(E.b+128))/255;return D});k.register("lighten",function(D,E){return{r:E.r>D.r?E.r:D.r,g:E.g>D.g?E.g:D.g,b:E.b>D.b?E.b:D.b}});k.register("darken",function(D,E){return{r:E.r>D.r?D.r:E.r,g:E.g>D.g?D.g:E.g,b:E.b>D.b?D.b:E.b}});A.register("fillColor",function(){var D;if(arguments.length===1){D=z.hexToRGB(arguments[0])}else{D={r:arguments[0],g:arguments[1],b:arguments[2]}}return this.process("fillColor",function(E){E.r=D.r;E.g=D.g;E.b=D.b;E.a=255;return E})});A.register("brightness",function(D){D=Math.floor(255*(D/100));return this.process("brightness",function(E){E.r+=D;E.g+=D;E.b+=D;return E})});A.register("saturation",function(D){D*=-0.01;return this.process("saturation",function(F){var E;E=Math.max(F.r,F.g,F.b);if(F.r!==E){F.r+=(E-F.r)*D}if(F.g!==E){F.g+=(E-F.g)*D}if(F.b!==E){F.b+=(E-F.b)*D}return F})});A.register("vibrance",function(D){D*=-1;return this.process("vibrance",function(F){var H,G,E;E=Math.max(F.r,F.g,F.b);G=(F.r+F.g+F.b)/3;H=((Math.abs(E-G)*2/255)*D)/100;if(F.r!==E){F.r+=(E-F.r)*H}if(F.g!==E){F.g+=(E-F.g)*H}if(F.b!==E){F.b+=(E-F.b)*H}return F})});A.register("greyscale",function(D){return this.process("greyscale",function(E){var F;F=m.luminance(E);E.r=F;E.g=F;E.b=F;return E})});A.register("contrast",function(D){D=Math.pow((D+100)/100,2);return this.process("contrast",function(E){E.r/=255;E.r-=0.5;E.r*=D;E.r+=0.5;E.r*=255;E.g/=255;E.g-=0.5;E.g*=D;E.g+=0.5;E.g*=255;E.b/=255;E.b-=0.5;E.b*=D;E.b+=0.5;E.b*=255;return E})});A.register("hue",function(D){return this.process("hue",function(G){var H,F,E;F=z.rgbToHSV(G.r,G.g,G.b);H=F.h*100;H+=Math.abs(D);H=H%100;H/=100;F.h=H;E=z.hsvToRGB(F.h,F.s,F.v);E.a=G.a;return E})});A.register("colorize",function(){var E,D;if(arguments.length===2){D=z.hexToRGB(arguments[0]);E=arguments[1]}else{if(arguments.length===4){D={r:arguments[0],g:arguments[1],b:arguments[2]};E=arguments[3]}}return this.process("colorize",function(F){F.r-=(F.r-D.r)*(E/100);F.g-=(F.g-D.g)*(E/100);F.b-=(F.b-D.b)*(E/100);return F})});A.register("invert",function(){return this.process("invert",function(D){D.r=255-D.r;D.g=255-D.g;D.b=255-D.b;return D})});A.register("sepia",function(D){if(D==null){D=100}D/=100;return this.process("sepia",function(E){E.r=Math.min(255,(E.r*(1-(0.607*D)))+(E.g*(0.769*D))+(E.b*(0.189*D)));E.g=Math.min(255,(E.r*(0.349*D))+(E.g*(1-(0.314*D)))+(E.b*(0.168*D)));E.b=Math.min(255,(E.r*(0.272*D))+(E.g*(0.534*D))+(E.b*(1-(0.869*D))));return E})});A.register("gamma",function(D){return this.process("gamma",function(E){E.r=Math.pow(E.r/255,D)*255;E.g=Math.pow(E.g/255,D)*255;E.b=Math.pow(E.b/255,D)*255;return E})});A.register("noise",function(D){D=Math.abs(D)*2.55;return this.process("noise",function(E){var F;F=m.randomRange(D*-1,D);E.r+=F;E.g+=F;E.b+=F;return E})});A.register("clip",function(D){D=Math.abs(D)*2.55;return this.process("clip",function(E){if(E.r>255-D){E.r=255}else{if(E.r<D){E.r=0}}if(E.g>255-D){E.g=255}else{if(E.g<D){E.g=0}}if(E.b>255-D){E.b=255}else{if(E.b<D){E.b=0}}return E})});A.register("channels",function(D){var F,E;if(typeof D!=="object"){return this}for(F in D){if(!n.call(D,F)){continue}E=D[F];if(E===0){delete D[F];continue}D[F]/=100}if(D.length===0){return this}return this.process("channels",function(G){if(D.red!=null){if(D.red>0){G.r+=(255-G.r)*D.red}else{G.r-=G.r*Math.abs(D.red)}}if(D.green!=null){if(D.green>0){G.g+=(255-G.g)*D.green}else{G.g-=G.g*Math.abs(D.green)}}if(D.blue!=null){if(D.blue>0){G.b+=(255-G.b)*D.blue}else{G.b-=G.b*Math.abs(D.blue)}}return G})});A.register("curves",function(){var G,D,O,H,F,K,N,E,L,J,M,I;D=arguments[0],O=2<=arguments.length?o.call(arguments,1):[];if(typeof D==="string"){D=D.split("")}if(D[0]==="v"){D=["r","g","b"]}if(O.length<3||O.length>4){throw"Invalid number of arguments to curves filter"}E=O[0];H=O[1];F=O.length===4?O[2]:O[1];K=O[O.length-1];G=m.bezier(E,H,F,K,0,255);if(E[0]>0){for(N=L=0,M=E[0];0<=M?L<M:L>M;N=0<=M?++L:--L){G[N]=E[1]}}if(K[0]<255){for(N=J=I=K[0];I<=255?J<=255:J>=255;N=I<=255?++J:--J){G[N]=K[1]}}return this.process("curves",function(P){var Q,R;for(N=Q=0,R=D.length;0<=R?Q<R:Q>R;N=0<=R?++Q:--Q){P[D[N]]=G[P[D[N]]]}return P})});A.register("exposure",function(F){var D,G,E;E=Math.abs(F)/100;D=[0,255*E];G=[255-(255*E),255];if(F<0){D=D.reverse();G=G.reverse()}return this.curves("rgb",[0,0],D,G,[255,255])});u.Plugin.register("crop",function(H,E,D,I){var G,F;if(D==null){D=0}if(I==null){I=0}if(typeof exports!=="undefined"&&exports!==null){G=new q(H,E)}else{G=document.createElement("canvas");i.copyAttributes(this.canvas,G);G.width=H;G.height=E}F=G.getContext("2d");F.drawImage(this.canvas,D,I,H,E,0,0,H,E);this.cropCoordinates={x:D,y:I};this.cropped=true;return this.replaceCanvas(G)});u.Plugin.register("resize",function(F){var E,D;if(F==null){F=null}if(F===null||((F.width==null)&&(F.height==null))){p.error("Invalid or missing dimensions given for resize");return}if(F.width==null){F.width=this.canvas.width*F.height/this.canvas.height}else{if(F.height==null){F.height=this.canvas.height*F.width/this.canvas.width}}if(typeof exports!=="undefined"&&exports!==null){E=new q(F.width,F.height)}else{E=document.createElement("canvas");i.copyAttributes(this.canvas,E);E.width=F.width;E.height=F.height}D=E.getContext("2d");D.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,F.width,F.height);this.resized=true;return this.replaceCanvas(E)});u.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))});u.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))});u.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])});u.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])});u.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])});u.Filter.register("motionBlur",function(D){var E;if(D===0||D===180){E=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]}else{if((D>0&&D<90)||(D>180&&D<270)){E=[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]}else{if(D===90||D===270){E=[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]}else{E=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}}}return this.processKernel("Motion Blur",E)});u.Filter.register("sharpen",function(D){if(D==null){D=100}D/=100;return this.processKernel("Sharpen",[0,-D,0,-D,4*D+1,-D,0,-D,0])});j={brightness:function(D,F,E){D.r=D.r-(D.r*F*E.strength);D.g=D.g-(D.g*F*E.strength);D.b=D.b-(D.b*F*E.strength);return D},gamma:function(D,F,E){D.r=Math.pow(D.r/255,Math.max(10*F*E.strength,1))*255;D.g=Math.pow(D.g/255,Math.max(10*F*E.strength,1))*255;D.b=Math.pow(D.b/255,Math.max(10*F*E.strength,1))*255;return D},colorize:function(D,F,E){D.r-=(D.r-E.color.r)*F;D.g-=(D.g-E.color.g)*F;D.b-=(D.b-E.color.b)*F;return D}};A.register("vignette",function(F,H){var G,D,E,I;if(H==null){H=60}if(typeof F==="string"&&F.substr(-1)==="%"){if(this.dimensions.height>this.dimensions.width){F=this.dimensions.width*(parseInt(F.substr(0,F.length-1),10)/100)}else{F=this.dimensions.height*(parseInt(F.substr(0,F.length-1),10)/100)}}H/=100;D=[this.dimensions.width/2,this.dimensions.height/2];I=Math.sqrt(Math.pow(D[0],2)+Math.pow(D[1],2));E=I-F;G=m.bezier([0,1],[30,30],[70,60],[100,80]);return this.process("vignette",function(J){var L,M,K;K=this.locationXY();L=m.distance(K.x,K.y,D[0],D[1]);if(L>E){M=Math.max(1,(G[Math.round(((L-E)/F)*100)]/10)*H);J.r=Math.pow(J.r/255,M)*255;J.g=Math.pow(J.g/255,M)*255;J.b=Math.pow(J.b/255,M)*255}return J})});A.register("rectangularVignette",function(G){var K,J,F,E,I,D,H;K={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}};G=i.extend(K,G);if(!G.size){return this}else{if(typeof G.size==="string"){F=parseInt(G.size,10)/100;G.size={width:this.dimensions.width*F,height:this.dimensions.height*F}}else{if(typeof G.size==="object"){H=["width","height"];for(I=0,D=H.length;I<D;I++){J=H[I];if(typeof G.size[J]==="string"){G.size[J]=this.dimensions[J]*(parseInt(G.size[J],10)/100)}}}else{if(G.size==="number"){E=G.size;G.size={width:E,height:E}}}}}if(typeof G.cornerRadius==="string"){G.cornerRadius=(G.size.width/2)*(parseInt(G.cornerRadius,10)/100)}G.strength/=100;G.size.width=Math.floor(G.size.width);G.size.height=Math.floor(G.size.height);G.image={width:this.dimensions.width,height:this.dimensions.height};if(G.method==="colorize"&&typeof G.color==="string"){G.color=z.hexToRGB(G.color)}G.coords={left:(this.dimensions.width-G.size.width)/2,right:this.dimensions.width-G.coords.left,bottom:(this.dimensions.height-G.size.height)/2,top:this.dimensions.height-G.coords.bottom};G.corners=[{x:G.coords.left+G.cornerRadius,y:G.coords.top-G.cornerRadius},{x:G.coords.right-G.cornerRadius,y:G.coords.top-G.cornerRadius},{x:G.coords.right-G.cornerRadius,y:G.coords.bottom+G.cornerRadius},{x:G.coords.left+G.cornerRadius,y:G.coords.bottom+G.cornerRadius}];G.maxDist=m.distance(0,0,G.corners[3].x,G.corners[3].y)-G.cornerRadius;return this.process("rectangularVignette",function(L){var O,N,M;N=this.locationXY();if((N.x>G.corners[0].x&&N.x<G.corners[1].x)&&(N.y>G.coords.bottom&&N.y<G.coords.top)){return L}if((N.x>G.coords.left&&N.x<G.coords.right)&&(N.y>G.corners[3].y&&N.y<G.corners[2].y)){return L}if(N.x>G.corners[0].x&&N.x<G.corners[1].x&&N.y>G.coords.top){O=(N.y-G.coords.top)/G.maxDist}else{if(N.y>G.corners[2].y&&N.y<G.corners[1].y&&N.x>G.coords.right){O=(N.x-G.coords.right)/G.maxDist}else{if(N.x>G.corners[0].x&&N.x<G.corners[1].x&&N.y<G.coords.bottom){O=(G.coords.bottom-N.y)/G.maxDist}else{if(N.y>G.corners[2].y&&N.y<G.corners[1].y&&N.x<G.coords.left){O=(G.coords.left-N.x)/G.maxDist}else{if(N.x<=G.corners[0].x&&N.y>=G.corners[0].y){M=u.distance(N.x,N.y,G.corners[0].x,G.corners[0].y);O=(M-G.cornerRadius)/G.maxDist}else{if(N.x>=G.corners[1].x&&N.y>=G.corners[1].y){M=u.distance(N.x,N.y,G.corners[1].x,G.corners[1].y);O=(M-G.cornerRadius)/G.maxDist}else{if(N.x>=G.corners[2].x&&N.y<=G.corners[2].y){M=u.distance(N.x,N.y,G.corners[2].x,G.corners[2].y);O=(M-G.cornerRadius)/G.maxDist}else{if(N.x<=G.corners[3].x&&N.y<=G.corners[3].y){M=u.distance(N.x,N.y,G.corners[3].x,G.corners[3].y);O=(M-G.cornerRadius)/G.maxDist}}}}}}}}if(O<0){return L}return j[G.method](L,O,G)})});(function(){var G,F,D,E,H;E=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];H=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];F=function(L,V,Q,P,O,N,U){var M,K,T,J,I,S,R;M=typeof exports!=="undefined"&&exports!==null?new q():document.createElement("canvas");M.width=L;M.height=V;J=Q+Math.cos(O)*N*0.5;S=P+Math.sin(O)*N*0.5;I=Q-Math.cos(O)*N*0.5;R=P-Math.sin(O)*N*0.5;K=M.getContext("2d");T=K.createLinearGradient(J,S,I,R);if(!U){T.addColorStop(0,"white");T.addColorStop(1,"black")}else{T.addColorStop(0,"white");T.addColorStop(0.5,"black");T.addColorStop(1,"white")}K.fillStyle=T;K.fillRect(0,0,L,V);return K.getImageData(0,0,L,V)};D=function(I,Q,M,L,P,O){var K,J,N;K=typeof exports!=="undefined"&&exports!==null?new q():document.createElement("canvas");K.width=I;K.height=Q;J=K.getContext("2d");N=J.createRadialGradient(M,L,P,M,L,O);N.addColorStop(1,"white");N.addColorStop(0,"black");J.fillStyle=N;J.fillRect(0,0,I,Q);return J.getImageData(0,0,I,Q)};G=function(){this.r=0;this.g=0;this.b=0;this.a=0;return this.next=null};u.Plugin.register("compoundBlur",function(aF,az,at,aq){var Z,af,ai,aM,N,aR,ax,aj,Q,K,aD,aQ,L,aS,ay,ao,J,ah,ae,aG,ad,aa,R,U,am,X,P,ab,T,al,O,ag,S,aP,ap,ak,ar,aB,an,M,aw,I,W,av,au,ac,Y,V,aO,aN,aL,aK,aJ,aI,aH,aE,aC,aA;I=this.dimensions.width;K=this.dimensions.height;ay=this.pixelData;ab=aF.data;M=I*K;aw=M<<2;R=[];for(aQ=aO=0;0<=aw?aO<aw:aO>aw;aQ=0<=aw?++aO:--aO){R[aQ]=ay[aQ]}N=0;ar=aq;aq-=1;while(ar-->=0){J=(az+0.5)|0;if(J===0){continue}if(J>256){J=256}aR=J+J+1;an=I<<2;W=I-1;aD=K-1;T=J+1;aB=T*(T+1)/2;ak=new G();S=void 0;ag=ak;for(aQ=aN=1;1<=aR?aN<aR:aN>aR;aQ=1<=aR?++aN:--aN){ag=ag.next=new G();if(aQ===T){S=ag}}ag.next=ak;aP=null;ap=null;V=ac=0;ae=E[J];O=H[J];for(au=aL=0;0<=K?aL<K:aL>K;au=0<=K?++aL:--aL){am=ax=Z=P=Q=ai=0;X=T*(U=R[ac]);aj=T*(aa=R[ac+1]);af=T*(ad=R[ac+2]);P+=aB*U;Q+=aB*aa;ai+=aB*ad;ag=ak;for(aQ=aK=0;0<=T?aK<T:aK>T;aQ=0<=T?++aK:--aK){ag.r=U;ag.g=aa;ag.b=ad;ag=ag.next}for(aQ=aJ=1;1<=T?aJ<T:aJ>T;aQ=1<=T?++aJ:--aJ){aG=ac+((W<aQ?W:aQ)<<2);P+=(ag.r=(U=R[aG]))*(al=T-aQ);Q+=(ag.g=(aa=R[aG+1]))*al;ai+=(ag.b=(ad=R[aG+2]))*al;am+=U;ax+=aa;Z+=ad;ag=ag.next}aP=ak;ap=S;for(av=aI=0;0<=I?aI<I:aI>I;av=0<=I?++aI:--aI){R[ac]=(P*ae)>>O;R[ac+1]=(Q*ae)>>O;R[ac+2]=(ai*ae)>>O;P-=X;Q-=aj;ai-=af;X-=aP.r;aj-=aP.g;af-=aP.b;aG=(V+((aG=av+T)<W?aG:W))<<2;am+=(aP.r=R[aG]);ax+=(aP.g=R[aG+1]);Z+=(aP.b=R[aG+2]);P+=am;Q+=ax;ai+=Z;aP=aP.next;X+=(U=ap.r);aj+=(aa=ap.g);af+=(ad=ap.b);am-=U;ax-=aa;Z-=ad;ap=ap.next;ac+=4}V+=I}for(av=aH=0;0<=I?aH<I:aH>I;av=0<=I?++aH:--aH){ax=Z=am=Q=ai=P=0;ac=av<<2;X=T*(U=R[ac]);aj=T*(aa=R[ac+1]);af=T*(ad=R[ac+2]);P+=aB*U;Q+=aB*aa;ai+=aB*ad;ag=ak;for(aQ=aE=0;0<=T?aE<T:aE>T;aQ=0<=T?++aE:--aE){ag.r=U;ag.g=aa;ag.b=ad;ag=ag.next}Y=I;for(aQ=aC=1;1<=T?aC<T:aC>T;aQ=1<=T?++aC:--aC){ac=(Y+av)<<2;P+=(ag.r=(U=R[ac]))*(al=T-aQ);Q+=(ag.g=(aa=R[ac+1]))*al;ai+=(ag.b=(ad=R[ac+2]))*al;am+=U;ax+=aa;Z+=ad;ag=ag.next;if(aQ<aD){Y+=I}}ac=av;aP=ak;ap=S;for(au=aA=0;0<=K?aA<K:aA>K;au=0<=K?++aA:--aA){aG=ac<<2;R[aG]=(P*ae)>>O;R[aG+1]=(Q*ae)>>O;R[aG+2]=(ai*ae)>>O;P-=X;Q-=aj;ai-=af;X-=aP.r;aj-=aP.g;af-=aP.b;aG=(av+(((aG=au+T)<aD?aG:aD)*I))<<2;P+=(am+=(aP.r=R[aG]));Q+=(ax+=(aP.g=R[aG+1]));ai+=(Z+=(aP.b=R[aG+2]));aP=aP.next;X+=(U=ap.r);aj+=(aa=ap.g);af+=(ad=ap.b);am-=U;ax-=aa;Z-=ad;ap=ap.next;ac+=I}}az*=at;aQ=M;while(--aQ>-1){aS=aQ<<2;ah=(ab[aS+2]&255)/255*aq;ao=ah|0;if(ao===N){aM=256*(ah-(ah|0));L=256-aM;ay[aS]=(ay[aS]*L+R[aS]*aM)>>8;ay[aS+1]=(ay[aS+1]*L+R[aS+1]*aM)>>8;ay[aS+2]=(ay[aS+2]*L+R[aS+2]*aM)>>8}else{if(ao===N+1){ay[aS]=R[aS];ay[aS+1]=R[aS+1];ay[aS+2]=R[aS+2]}}}N++}return this});u.Filter.register("tiltShift",function(I){var K,J;K={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3};I=i.extend(K,I);I.angle*=Math.PI/180;J=F(this.dimensions.width,this.dimensions.height,I.center.x,I.center.y,I.angle,I.focusWidth,true);return this.processPlugin("compoundBlur",[J,I.startRadius,I.radiusFactor,I.steps])});return u.Filter.register("radialBlur",function(K){var M,L,J,I;M={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null};K=i.extend(M,K);if(!K.radius){K.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width}J=(K.radius/2)-K.size;I=K.radius/2;L=D(this.dimensions.width,this.dimensions.height,K.center.x,K.center.y,J,I);return this.processPlugin("compoundBlur",[L,K.startRadius,K.radiusFactor,K.steps])})})();u.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])});u.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])});u.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])});u.Filter.register("posterize",function(F){var D,E;D=256/F;E=255/(F-1);return this.process("posterize",function(G){G.r=Math.floor(Math.floor(G.r/D)*E);G.g=Math.floor(Math.floor(G.g/D)*E);G.b=Math.floor(Math.floor(G.b/D)*E);return G})});u.Filter.register("vintage",function(D){if(D==null){D=true}this.greyscale();this.contrast(5);this.noise(3);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.87);if(D){return this.vignette("40%",30)}});u.Filter.register("lomo",function(D){if(D==null){D=true}this.brightness(15);this.exposure(15);this.curves("rgb",[0,0],[200,0],[155,255],[255,255]);this.saturation(-20);this.gamma(1.8);if(D){this.vignette("50%",60)}return this.brightness(5)});u.Filter.register("clarity",function(D){if(D==null){D=false}this.vibrance(20);this.curves("rgb",[5,0],[130,150],[190,220],[250,255]);this.sharpen(15);this.vignette("45%",20);if(D){this.greyscale();this.contrast(4)}return this});u.Filter.register("sinCity",function(){this.contrast(100);this.brightness(15);this.exposure(10);this.posterize(80);this.clip(30);return this.greyscale()});u.Filter.register("sunrise",function(){this.exposure(3.5);this.saturation(-5);this.vibrance(50);this.sepia(60);this.colorize("#e87b22",10);this.channels({red:8,blue:8});this.contrast(5);this.gamma(1.2);return this.vignette("55%",25)});u.Filter.register("crossProcess",function(){this.exposure(5);this.colorize("#e87b22",4);this.sepia(20);this.channels({blue:8,red:3});this.curves("b",[0,0],[100,150],[180,180],[255,255]);this.contrast(15);this.vibrance(75);return this.gamma(1.6)});u.Filter.register("orangePeel",function(){this.curves("rgb",[0,0],[100,50],[140,200],[255,255]);this.vibrance(-30);this.saturation(-30);this.colorize("#ff9000",30);this.contrast(-5);return this.gamma(1.4)});u.Filter.register("love",function(){this.brightness(5);this.exposure(8);this.contrast(4);this.colorize("#c42007",30);this.vibrance(50);return this.gamma(1.3)});u.Filter.register("grungy",function(){this.gamma(1.5);this.clip(25);this.saturation(-60);this.contrast(5);this.noise(5);return this.vignette("50%",30)});u.Filter.register("jarques",function(){this.saturation(-35);this.curves("b",[20,0],[90,120],[186,144],[255,230]);this.curves("r",[0,0],[144,90],[138,120],[255,255]);this.curves("g",[10,0],[115,105],[148,100],[255,248]);this.curves("rgb",[0,0],[120,100],[128,140],[255,255]);return this.sharpen(20)});u.Filter.register("pinhole",function(){this.greyscale();this.sepia(10);this.exposure(10);this.contrast(15);return this.vignette("60%",35)});u.Filter.register("oldBoot",function(){this.saturation(-20);this.vibrance(-50);this.gamma(1.1);this.sepia(30);this.channels({red:-10,blue:5});this.curves("rgb",[0,0],[80,50],[128,230],[255,255]);return this.vignette("60%",30)});u.Filter.register("glowingSun",function(D){if(D==null){D=true}this.brightness(10);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.gamma(0.8);this.filter.contrast(50);return this.filter.exposure(10)});this.newLayer(function(){this.setBlendingMode("softLight");this.opacity(80);return this.fillColor("#f49600")});this.exposure(20);this.gamma(0.8);if(D){return this.vignette("45%",20)}});u.Filter.register("hazyDays",function(){this.gamma(1.2);this.newLayer(function(){this.setBlendingMode("overlay");this.opacity(60);this.copyParent();this.filter.channels({red:5});return this.filter.stackBlur(15)});this.newLayer(function(){this.setBlendingMode("addition");this.opacity(40);return this.fillColor("#6899ba")});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(35);this.copyParent();this.filter.brightness(40);this.filter.vibrance(40);this.filter.exposure(30);this.filter.contrast(15);this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]);this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]);this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]);return this.filter.stackBlur(5)});this.curves("r",[20,0],[128,158],[128,128],[235,255]);this.curves("g",[20,0],[128,128],[128,128],[235,255]);this.curves("b",[20,0],[128,108],[128,128],[235,255]);return this.vignette("45%",20)});u.Filter.register("herMajesty",function(){this.brightness(40);this.colorize("#ea1c5d",10);this.curves("b",[0,10],[128,180],[190,190],[255,255]);this.newLayer(function(){this.setBlendingMode("overlay");this.opacity(50);this.copyParent();this.filter.gamma(0.7);return this.newLayer(function(){this.setBlendingMode("normal");this.opacity(60);return this.fillColor("#ea1c5d")})});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(60);this.copyParent();this.filter.saturation(50);this.filter.hue(90);return this.filter.contrast(10)});this.gamma(1.4);this.vibrance(-30);this.newLayer(function(){this.opacity(10);return this.fillColor("#e5f0ff")});return this});u.Filter.register("nostalgia",function(){this.saturation(20);this.gamma(1.4);this.greyscale();this.contrast(5);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.8);this.contrast(5);this.exposure(10);this.newLayer(function(){this.setBlendingMode("overlay");this.copyParent();this.opacity(55);return this.filter.stackBlur(10)});return this.vignette("50%",30)});u.Filter.register("hemingway",function(){this.greyscale();this.contrast(10);this.gamma(0.9);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(40);this.copyParent();this.filter.exposure(15);this.filter.contrast(15);return this.filter.channels({green:10,red:5})});this.sepia(30);this.curves("rgb",[0,10],[120,90],[180,200],[235,255]);this.channels({red:5,green:-2});return this.exposure(15)});u.Filter.register("concentrate",function(){this.sharpen(40);this.saturation(-50);this.channels({red:3});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.sharpen(5);this.filter.contrast(50);this.filter.exposure(10);return this.filter.channels({blue:5})});return this.brightness(10)});(function(){var E,D,F;D=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];F=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];E=function(){this.r=0;this.g=0;this.b=0;this.a=0;return this.next=null};u.Plugin.register("stackBlur",function(ak){var T,Y,aa,aA,aj,ab,K,H,an,ay,X,ap,W,U,L,O,ae,Q,J,M,ad,I,Z,N,az,ag,ac,al,af,G,R,ai,ah,V,S,P,ax,aw,av,au,at,ar,aq,ao,am;if(isNaN(ak)||ak<1){return}ak|=0;L=this.pixelData;G=this.dimensions.width;H=this.dimensions.height;aA=ak+ak+1;af=G<<2;R=G-1;an=H-1;M=ak+1;al=M*(M+1)/2;ac=new E();Z=ac;for(ay=ax=1;1<=aA?ax<aA:ax>aA;ay=1<=aA?++ax:--ax){Z=Z.next=new E();if(ay===M){N=Z}}Z.next=ac;az=null;ag=null;P=V=0;X=D[ak];I=F[ak];for(ah=aw=0;0<=H?aw<H:aw>H;ah=0<=H?++aw:--aw){ae=aj=T=J=K=aa=0;Q=M*(O=L[V]);ab=M*(U=L[V+1]);Y=M*(W=L[V+2]);J+=al*O;K+=al*U;aa+=al*W;Z=ac;for(ay=av=0;0<=M?av<M:av>M;ay=0<=M?++av:--av){Z.r=O;Z.g=U;Z.b=W;Z=Z.next}for(ay=au=1;1<=M?au<M:au>M;ay=1<=M?++au:--au){ap=V+((R<ay?R:ay)<<2);J+=(Z.r=(O=L[ap]))*(ad=M-ay);K+=(Z.g=(U=L[ap+1]))*ad;aa+=(Z.b=(W=L[ap+2]))*ad;ae+=O;aj+=U;T+=W;Z=Z.next}az=ac;ag=N;for(ai=at=0;0<=G?at<G:at>G;ai=0<=G?++at:--at){L[V]=(J*X)>>I;L[V+1]=(K*X)>>I;L[V+2]=(aa*X)>>I;J-=Q;K-=ab;aa-=Y;Q-=az.r;ab-=az.g;Y-=az.b;ap=(P+((ap=ai+ak+1)<R?ap:R))<<2;ae+=(az.r=L[ap]);aj+=(az.g=L[ap+1]);T+=(az.b=L[ap+2]);J+=ae;K+=aj;aa+=T;az=az.next;Q+=(O=ag.r);ab+=(U=ag.g);Y+=(W=ag.b);ae-=O;aj-=U;T-=W;ag=ag.next;V+=4}P+=G}for(ai=ar=0;0<=G?ar<G:ar>G;ai=0<=G?++ar:--ar){aj=T=ae=K=aa=J=0;V=ai<<2;Q=M*(O=L[V]);ab=M*(U=L[V+1]);Y=M*(W=L[V+2]);J+=al*O;K+=al*U;aa+=al*W;Z=ac;for(ay=aq=0;0<=M?aq<M:aq>M;ay=0<=M?++aq:--aq){Z.r=O;Z.g=U;Z.b=W;Z=Z.next}S=G;for(ay=ao=1;1<=ak?ao<=ak:ao>=ak;ay=1<=ak?++ao:--ao){V=(S+ai)<<2;J+=(Z.r=(O=L[V]))*(ad=M-ay);K+=(Z.g=(U=L[V+1]))*ad;aa+=(Z.b=(W=L[V+2]))*ad;ae+=O;aj+=U;T+=W;Z=Z.next;if(ay<an){S+=G}}V=ai;az=ac;ag=N;for(ah=am=0;0<=H?am<H:am>H;ah=0<=H?++am:--am){ap=V<<2;L[ap]=(J*X)>>I;L[ap+1]=(K*X)>>I;L[ap+2]=(aa*X)>>I;J-=Q;K-=ab;aa-=Y;Q-=az.r;ab-=az.g;Y-=az.b;ap=(ai+(((ap=ah+M)<an?ap:an)*G))<<2;J+=(ae+=(az.r=L[ap]));K+=(aj+=(az.g=L[ap+1]));aa+=(T+=(az.b=L[ap+2]));az=az.next;Q+=(O=ag.r);ab+=(U=ag.g);Y+=(W=ag.b);ae-=O;aj-=U;T-=W;ag=ag.next;V+=G}}return this});return u.Filter.register("stackBlur",function(G){return this.processPlugin("stackBlur",[G])})})();u.Filter.register("threshold",function(D){return this.process("threshold",function(F){var E;E=(0.2126*F.r)+(0.7152*F.g)+(0.0722*F.b);if(E<D){F.r=0;F.g=0;F.b=0}else{F.r=255;F.g=255;F.b=255}return F})})}).call(this);(function(){var f,c,e,b,d,i,a,h,g={}.hasOwnProperty;c=null;i=null;b={};f=false;e=false;a=_.debounce(function(){var j,k;if(f){e=true;return}else{e=false}f=true;c.revert();for(j in b){if(!g.call(b,j)){continue}k=b[j];k=parseFloat(k,10);if(k===0){continue}c[j](k)}return c.render(function(){f=false;if(e){return a()}})},400);d=false;h=function(k){var l,j;if(d){return}$("#PresetFilters a").removeClass("Active");l=$("#PresetFilters a[data-preset='"+k+"']");j=l.html();l.addClass("Active").html("Rendering...");d=true;i.revert();i[k]();return i.render(function(){l.html(j);return d=false})};$(document).ready(function(){if(!($("#example").length>0)){return}c=Caman("#example");i=Caman("#preset-example");$(".FilterSetting input").each(function(){var j;j=$(this).data("filter");return b[j]=$(this).val()});$("#Filters").on("change",".FilterSetting input",function(){var j,k;j=$(this).data("filter");k=$(this).val();b[j]=k;$(this).find("~ .FilterValue").html(k);return a()});return $("#PresetFilters").on("click","a",function(){return h($(this).data("preset"))})})}).call(this);(function(){var a;a=function(d){var b,c,e;e=d.attr("id");d.attr("id","");c=$("<div>").css({position:"absolute",visibility:"hidden",top:$(document).scrollTop()+"px"}).attr("id",e).appendTo(document.body);document.location.hash="#"+e;c.remove();d.attr("id",e);b=$("#GuideSections li > a").filter("[href=#"+(d.attr("id"))+"]");b.parents("ul").find(".Active").removeClass("Active");return b.parents("li").addClass("Active")};$(document).ready(function(){var b;$("#GuideSections").on("click","a",function(){var c,d;c=$($(this).attr("href"));d=Math.max(0,c.position().top-129);document.location.hash=$(this).attr("href");setTimeout(function(){return $("body").scrollTop(d)},50);return false});b=_.map($("#GuideSections li > a"),function(c){return $($(c).attr("href"))});b=b.reverse();return $(document).on("scroll",_.throttle(function(){var e,f,d,c;f=$(document).scrollTop();for(d=0,c=b.length;d<c;d++){e=b[d];if(f>=e.position().top-130){a(e);return}}},200))})}).call(this);